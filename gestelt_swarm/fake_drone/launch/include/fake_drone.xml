<!-- Spawns a fake drone for testing architecture and algorithms-->

<launch>
  <arg name="cfg_filepath" default="" />

  <arg name="drone_id"/>
  <arg name="drone_id_ns" value="drone$(arg drone_id)"/>
  <!-- initial position -->
  <arg name="init_x" default="0.0"/>
  <arg name="init_y" default="0.0"/>
  <arg name="init_z" default="0.0"/>
  <!-- Mavros topics -->
  <arg name="command_topic" default="mavros/setpoint_raw/local" />
  <arg name="odometry_topic" default="mavros/local_position/odom" />
  <arg name="pose_topic" default="mavros/local_position/pose" />

  <arg name="drone_origin_frame" default="map"/>
  <arg name="drone_base_link_frame" default="$(arg drone_id_ns)_base_link"/>

  <!-- Static TF from base_link to camera_link -->
  <node pkg="tf" type="static_transform_publisher" 
    name="$(arg drone_id_ns)_base_link_to_cam_link_tf" 
    args="0.08 0 0.02 0 0 0 1 $(arg drone_id_ns)_base_link $(arg drone_id_ns)_cam_link 100" />

  <group ns="$(arg drone_id_ns)">
    <!-- Simulated quadcopter -->
    <node pkg="fake_drone" type="fake_drone_node" name="fake_drone_$(arg drone_id)" required="true" output="screen">
        <rosparam command="load" file="$(arg cfg_filepath)" />

        <remap from="mavros/setpoint_raw/local" to="$(arg command_topic)"/>
        <remap from="mavros/local_position/odom" to="$(arg odometry_topic)"/>
        <remap from="mavros/local_position/pose" to="$(arg pose_topic)"/>

        <param name="uav/id" value="$(arg drone_id)"/>
        <param name="uav/init_x" value="$(arg init_x)"/>
        <param name="uav/init_y" value="$(arg init_y)"/>
        <param name="uav/init_z" value="$(arg init_z)"/>

        <param name="uav/origin_frame" value="$(arg drone_origin_frame)"/>
        <param name="uav/base_link_frame" value="$(arg drone_base_link_frame)"/>
    </node>

    <!-- Drone Visualization -->
    <node pkg="mavros_extras" type="visualization" name="mavros_visualization" required="false" output="screen">

      <remap from="local_position" to="$(arg pose_topic)"/>
      <remap from="local_setpoint" to="mavros/setpoint_position/local"/>
      
      <param name="fixed_frame_id" value="$(arg drone_origin_frame)"/>
      <param name="child_frame_id" value="$(arg drone_base_link_frame)"/>

      <param name="marker_scale" value="1.0"/>
      <param name="num_rotors" value="4"/>
      <param name="arm_len" value="0.085"/>
      <param name="body_width" value="0.1"/>
      <param name="body_height" value="0.11"/>
      <param name="max_track_size" value="1000"/>

    </node>

  </group>

</launch>
